<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오버레이 테스트 - GZONESOFT</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <style>
        .demo-video {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }
        .demo-video::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: pulse 3s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.7; }
        }
        .controls-panel {
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h1 class="display-6">
                    <i class="fas fa-layer-group me-3"></i>
                    스트리밍 오버레이 테스트
                </h1>
                <p class="lead">실시간 시간 표시와 서비스명 오버레이 기능을 테스트해보세요</p>
            </div>
        </div>

        <div class="row">
            <!-- 데모 비디오 영역 -->
            <div class="col-lg-8 mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-tv me-2"></i>
                            오버레이 데모
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="video-container">
                            <div id="demoVideo" class="demo-video ratio ratio-16x9">
                            </div>
                            
                            <!-- 서비스 이름 오버레이 -->
                            <div class="video-overlay overlay-service-name overlay-fade-in" id="serviceNameOverlay">
                                GZONESOFT LIVE
                            </div>
                            
                            <!-- 시간 오버레이 -->
                            <div class="video-overlay overlay-time overlay-fade-in" id="timeOverlay">
                                <div class="overlay-current-time" id="currentTime">--:--:--</div>
                                <div class="overlay-date" id="currentDate">----년 --월 --일</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 실제 스트림 테스트 -->
                <div class="card mt-4">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-broadcast-tower me-2"></i>
                            실제 스트림 테스트
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <input type="text" class="form-control" id="testStreamKey" 
                                       placeholder="테스트할 스트림 키를 입력하세요">
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-success w-100" onclick="testRealStream()">
                                    <i class="fas fa-play me-1"></i>
                                    실제 스트림 테스트
                                </button>
                            </div>
                        </div>
                        
                        <div id="realStreamPlayer" class="mt-3" style="display: none;">
                            <div class="ratio ratio-16x9 bg-dark d-flex align-items-center justify-content-center">
                                <div class="text-white text-center">
                                    <div class="spinner-border mb-3"></div>
                                    <h5>실제 스트림 로딩 중...</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 컨트롤 패널 -->
            <div class="col-lg-4">
                <div class="controls-panel p-4">
                    <h5 class="mb-4">
                        <i class="fas fa-sliders-h me-2"></i>
                        오버레이 설정
                    </h5>
                    
                    <!-- 서비스명 설정 -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-tag me-1"></i>
                            서비스 이름
                        </label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="serviceNameInput" 
                                   value="GZONESOFT LIVE" placeholder="서비스 이름">
                            <button class="btn btn-outline-primary" onclick="updateServiceName()">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                        <small class="text-muted">좌측 상단에 표시됩니다</small>
                    </div>
                    
                    <!-- 시간 형식 설정 -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-clock me-1"></i>
                            시간 형식
                        </label>
                        <select class="form-select" id="timeFormat" onchange="updateTimeFormat()">
                            <option value="24">24시간 (HH:MM:SS)</option>
                            <option value="12">12시간 (AM/PM)</option>
                            <option value="simple">간단 (HH:MM)</option>
                        </select>
                        <small class="text-muted">우측 하단에 표시됩니다</small>
                    </div>
                    
                    <!-- 오버레이 가시성 -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-eye me-1"></i>
                            오버레이 표시
                        </label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="showServiceName" 
                                   checked onchange="toggleOverlay('service')">
                            <label class="form-check-label" for="showServiceName">
                                서비스명 표시
                            </label>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="showTime" 
                                   checked onchange="toggleOverlay('time')">
                            <label class="form-check-label" for="showTime">
                                시간 표시
                            </label>
                        </div>
                    </div>
                    
                    <!-- 투명도 설정 -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-adjust me-1"></i>
                            투명도 조절
                        </label>
                        <input type="range" class="form-range" id="opacityRange" 
                               min="0.3" max="1" step="0.1" value="1" 
                               oninput="updateOpacity(this.value)">
                        <small class="text-muted">현재: <span id="opacityValue">100%</span></small>
                    </div>
                    
                    <!-- 프리셋 -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-magic me-1"></i>
                            프리셋
                        </label>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-info btn-sm" onclick="applyPreset('minimal')">
                                미니멀
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="applyPreset('full')">
                                전체 표시
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="applyPreset('broadcast')">
                                방송용
                            </button>
                        </div>
                    </div>
                    
                    <!-- 현재 시간 -->
                    <div class="text-center">
                        <div class="card bg-dark text-white">
                            <div class="card-body py-3">
                                <h6 class="mb-1">현재 시간</h6>
                                <div id="currentSystemTime" class="h5 mb-0">--:--:--</div>
                                <small id="currentSystemDate">----년 --월 --일</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.6.2/flv.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.10/hls.min.js"></script>
    <script src="viewer.js"></script>
    
    <script>
        let updateInterval;
        let timeFormat = '24';
        let realStreamViewer = null;
        
        // 페이지 로드시 시작
        document.addEventListener('DOMContentLoaded', () => {
            startOverlayDemo();
            realStreamViewer = new StreamViewer();
        });
        
        // 오버레이 데모 시작
        function startOverlayDemo() {
            updateInterval = setInterval(updateTime, 1000);
            updateTime(); // 즉시 한 번 업데이트
        }
        
        // 시간 업데이트
        function updateTime() {
            const now = new Date();
            
            let timeString;
            switch (timeFormat) {
                case '12':
                    timeString = now.toLocaleTimeString('ko-KR', {
                        hour12: true,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    break;
                case 'simple':
                    timeString = now.toLocaleTimeString('ko-KR', {
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    break;
                default: // 24
                    timeString = now.toLocaleTimeString('ko-KR', {
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
            }
            
            const dateString = now.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'short'
            });
            
            // 오버레이 업데이트
            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
            
            // 시스템 시간 업데이트
            document.getElementById('currentSystemTime').textContent = timeString;
            document.getElementById('currentSystemDate').textContent = dateString;
        }
        
        // 서비스명 업데이트
        function updateServiceName() {
            const serviceName = document.getElementById('serviceNameInput').value || 'GZONESOFT LIVE';
            document.getElementById('serviceNameOverlay').textContent = serviceName;
            showToast('서비스명이 업데이트되었습니다!', 'success');
        }
        
        // 시간 형식 업데이트
        function updateTimeFormat() {
            timeFormat = document.getElementById('timeFormat').value;
            updateTime();
            showToast('시간 형식이 변경되었습니다!', 'info');
        }
        
        // 오버레이 토글
        function toggleOverlay(type) {
            if (type === 'service') {
                const overlay = document.getElementById('serviceNameOverlay');
                const checkbox = document.getElementById('showServiceName');
                overlay.style.display = checkbox.checked ? 'block' : 'none';
            } else if (type === 'time') {
                const overlay = document.getElementById('timeOverlay');
                const checkbox = document.getElementById('showTime');
                overlay.style.display = checkbox.checked ? 'block' : 'none';
            }
        }
        
        // 투명도 업데이트
        function updateOpacity(value) {
            const serviceOverlay = document.getElementById('serviceNameOverlay');
            const timeOverlay = document.getElementById('timeOverlay');
            
            serviceOverlay.style.opacity = value;
            timeOverlay.style.opacity = value;
            
            document.getElementById('opacityValue').textContent = Math.round(value * 100) + '%';
        }
        
        // 프리셋 적용
        function applyPreset(preset) {
            switch (preset) {
                case 'minimal':
                    document.getElementById('showServiceName').checked = false;
                    document.getElementById('showTime').checked = true;
                    document.getElementById('timeFormat').value = 'simple';
                    document.getElementById('opacityRange').value = '0.7';
                    break;
                case 'full':
                    document.getElementById('showServiceName').checked = true;
                    document.getElementById('showTime').checked = true;
                    document.getElementById('timeFormat').value = '24';
                    document.getElementById('opacityRange').value = '1';
                    break;
                case 'broadcast':
                    document.getElementById('showServiceName').checked = true;
                    document.getElementById('showTime').checked = true;
                    document.getElementById('timeFormat').value = '24';
                    document.getElementById('opacityRange').value = '0.9';
                    document.getElementById('serviceNameInput').value = 'GZONESOFT 방송';
                    updateServiceName();
                    break;
            }
            
            // 설정 적용
            toggleOverlay('service');
            toggleOverlay('time');
            updateTimeFormat();
            updateOpacity(document.getElementById('opacityRange').value);
            
            showToast(`${preset} 프리셋이 적용되었습니다!`, 'info');
        }
        
        // 실제 스트림 테스트
        function testRealStream() {
            const streamKey = document.getElementById('testStreamKey').value.trim();
            if (!streamKey) {
                showToast('스트림 키를 입력해주세요!', 'warning');
                return;
            }
            
            const playerContainer = document.getElementById('realStreamPlayer');
            playerContainer.style.display = 'block';
            
            // 실제 스트림 시청자 객체에서 로드
            if (realStreamViewer) {
                realStreamViewer.currentStreamKey = streamKey;
                realStreamViewer.loadStream(streamKey);
                
                // 플레이어 업데이트
                setTimeout(() => {
                    const webPlayer = document.querySelector('#webPlayer');
                    if (webPlayer && webPlayer.innerHTML) {
                        playerContainer.innerHTML = webPlayer.innerHTML;
                    }
                }, 1000);
            }
        }
        
        // 토스트 메시지 표시
        function showToast(message, type) {
            const toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
            toastContainer.style.zIndex = '9999';
            
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : type === 'error' ? 'danger' : 'info'} border-0`;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times' : 'info-circle'} me-2"></i>
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            document.body.appendChild(toastContainer);
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // 3초 후 자동 제거
            setTimeout(() => {
                toastContainer.remove();
            }, 3000);
        }
        
        // 키보드 단축키
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case '1':
                        e.preventDefault();
                        applyPreset('minimal');
                        break;
                    case '2':
                        e.preventDefault();
                        applyPreset('full');
                        break;
                    case '3':
                        e.preventDefault();
                        applyPreset('broadcast');
                        break;
                    case 'Enter':
                        e.preventDefault();
                        testRealStream();
                        break;
                }
            }
        });
        
        // Enter 키로 스트림 테스트
        document.getElementById('testStreamKey').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                testRealStream();
            }
        });
        
        // 페이지 언로드 시 정리
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            if (realStreamViewer && realStreamViewer.hls) {
                realStreamViewer.hls.destroy();
            }
        });
    </script>
</body>
</html>